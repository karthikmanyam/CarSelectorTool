<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Car Selection System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- <link rel="stylesheet" href="style.css"> -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- <link rel="stylesheet" type="text/css" href="styles.css"> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src='//www.aa.com/jquery.js'></script>
    
    <script src="fuzzyset.js"></script>

    <style>
    body {
    background-image: url("car.jpeg");
    background-size: cover;
    background-repeat: no-repeat;
    /* background-position: center; */
  }
    .form-container {
      max-width: 500px;
      margin: 0 auto;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 20px;
      border-radius: 10px;
      margin-top: 50px;
      box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.75);
    }
    .form-container h2 {
      margin-bottom: 20px;
    }
    .form-control {
      background-color: rgba(255, 255, 255, 0.2);
      color: #fff;
      border-color: #fff;
    }
    .form-control:focus {
      background-color: rgba(255, 255, 255, 0.4);
      /* color: #fff;  */
      /* border-color: #fff; */
    }
    .btn {
      background-color: #fff;
      color: #000;
      border-color: #fff;
    }
    .btn:hover {
      background-color: #000;
       color: #fff; 
    }
    h2 {
  text-align: center;
}
h1 {
  text-align: center;
}
  </style>
  </head>
  <body>
  <h1>Car Selector Tool</h1>
  <!-- <button id="voice-input-btn"><i class="fa fa-microphone"></i></button> -->
  <div class="container">
    <div class="form-container">
      <h2 text-align="center">Select from below options</h2>
      <form>
        <div class="form-group">
          <label for="car-model"><b>Make:</b></label>
          <select class="form-control" id="car-model" name="car-model">
            <option value="" disabled selected hidden>Select car model</option>
            <option value="toyota">Toyota</option>
            <option value="honda">Honda</option>
            <option value="bmw">BMW</option>
            <option value="mercedes">Mercedes</option>
            <option value="ferrari">Ferrari</option>
          </select>
        </div>
        <div class="form-group">
          <label for="budget"><b>Budget:</b></label>
          <select class="form-control" id="budget" name="budget">
            <option value="" disabled selected hidden>Select Budget</option>
            <option value="low">Low</option>
            <option value="medium">Medium</option>
            <option value="high">High</option>
          </select>
        </div>
        <div class="form-group">
          <label for="car-type"><b>Car Type:</b></label>
          <select class="form-control" id="car-type" name="car-type" >
            <option value="" disabled selected hidden>Select car Type</option>
            <option value="economy">Economy</option>
            <option value="luxury">Luxury</option>
          </select>
        </div>
        <div class="form-group">
            <label for="car-fuel"><b>Fuel Type:</b></label>
            <select id="car-fuel" name="car-fuel" class="form-control">
              <option value="" disabled selected hidden>Select Fuel Type</option>
              <option value="petrol">Petrol</option>
              <option value="diesel">Diesel</option>
              <option value="electric">Electric</option>
              <option value="hybrid">Hybrid</option>
            </select>
          </div>
        <button type="submit" onclick="submitForm()" class="btn btn-primary btn-block">Submit</button>
      </form>

   
      <script>
      
        var isClose=true;
        const stopwords = ["of", "the", "a", "an", "any", "is", "can", "who", "what", "why", "whom","how","much","is"];
        var editor = "sorts\n" +
  " #budget = {low, medium, high}.\n" +
  " #preference = {economy, luxury}.\n" +
  " #car = {toyota, honda, bmw, mercedes, ferrari}.\n" +
  " #fuelEconomy={10,20,30,40,50}.\n" +
  " #number={25,35,40,50,60}.\n" +
  "predicates\n" +
  " within_budget(#budget, #car).\n" +
  " prefer(#preference, #car).\n" +
  " costly(#car).\n" +
  " price(#car,#number).\n" +
  " fuel(#car,#fuelEconomy).\n" +
  " cheap(#car).\n" +
  "rules\n" +
  " price(toyota,25).\n" +
  " price(honda,35).\n" +
  " price(bmw,40).\n" +
  " price(mercedes,50).\n" +
  " price(ferrari,60).\n" +
  " fuel(toyota,50).\n" +
  " fuel(honda,40).\n" +
  " fuel(bmw,30).\n" +
  " fuel(mercedes,20).\n" +
  " fuel(ferrari,10).\n" +
  " within_budget(low, toyota).\n" +
  " within_budget(low, honda).\n" +
  " within_budget(medium, toyota).\n" +
  " within_budget(medium, honda).\n" +
  " within_budget(medium, bmw).\n" +
  " within_budget(high, toyota).\n" +
  " within_budget(high, honda).\n" +
  " within_budget(high, bmw).\n" +
  " within_budget(high, mercedes).\n" +
  " within_budget(high,ferrari).\n" +
  " prefer(economy, toyota).\n" +
  " prefer(economy, honda).\n" +
  " prefer(luxury, bmw).\n" +
  " prefer(luxury, mercedes).\n" +
  " prefer(luxury,ferrari).\n" +
  " costly(X):-within_budget(high,X),prefer(luxury,X),price(X,Y),Y>=40.\n" +
  " cheap(X):- not costly(X).";
          // sorts
          var contstring = editor.split("sorts\n")[1].split("predicates\n");
          console.log(contstring)
          var sortstring = contstring[0].split('.');
          sortstring.splice(-1, 1);
          
          var sorts = {};
          sortstring = sortstring.map(d => d.replace(/\n/g, '').trim()).forEach(d => {
              var par = d.split("=");
              sorts[par[0].replace(/#/, '').trim()] = par[1].replace(/{|}/g, '').split(',').map(w => w.trim())
          })
          console.log("final is"+sortstring);
          console.log(sorts);
          // predicates
          var predicates = {};
          contstring = contstring[1].split("rules\n");
          sortstring = contstring[0].split('.');
          sortstring.splice(-1, 1);
          sortstring.forEach(d => {
              var part = d.replace(/\n/g, '').trim().split('(');
              var func = part[0];
              predicates[func] = {};
              var par = part[1].split(',').map(e => e.replace(/#|\)/g, '').trim());
              var par1 = sorts[par[0]].slice();
              par1.push("X");
              par.splice(0, 1);
              par1.forEach(e => {
                  var strinh = (e == 'X' ? '' : (e + ' ')) + func;
                  predicates[func][strinh] = func + "(" + e + ")";
                  par.forEach(par2 => {
                      var temp = sorts[par2].slice();
                      temp.push("X");
                      temp.forEach(t => {
                          var strinh = (e == 'X' ? '' : (e + ' ')) + func + (t == 'X' ? '' : (' ' + t));
                          // if (strinh != fubnc)
                          predicates[func][strinh] = func + "(" + e + "," + t + ")";
                      })
                  });
              });
              console.log(predicates)
          });
  
  
          var all_predicates = [];
          for (var key1 in predicates) {
              if (predicates.hasOwnProperty(key1)) {
                  for (var key2 in predicates[key1]) {
                      if (predicates[key1].hasOwnProperty(key2))
                          all_predicates.push(key2);
                  }
              }
  
          }
          all_predicates.push('speak spanish'); // extra terms
          a = FuzzySet(all_predicates);
        
        console.log(all_predicates)
        
        
        
  
        // Get DOM elements
        const answerDiv = document.querySelector('#answer');
        const voiceBtn = document.getElementById('voice-input-btn');
        const textInput = document.getElementById('text-input');
        const submitBtn = document.getElementById('submit-btn');
        const answerBox = document.getElementById('answer-box');
  
        submitBtn.addEventListener('click', () => {
          const question = textInput.value;
          if (question.trim() === '') {
            answerBox.innerHTML = 'Please ask a question.';
            return;
          }
          var trim_script = question.split(" ");
          trim_script = trim_script.filter(f => !stopwords.includes(f));
          console.log("the script is"+trim_script)
          var queryQues = a.get(trim_script.join(" "), null, 0.5);
          console.log(queryQues); 
          getAnswer(queryQues);
          
        });
  
        
  
  
        function getAnswer(question) {
          
          if (question!=null) {
                  var mainkey = question[0][1].replace('speak ','');
                  var answerarr = mainkey.split(' ');
                  var key1 = '';
                  answerarr.forEach(d => {
                      key1 = (predicates[d] != undefined) ? d : key1;
                  });
                  
                  var key2 = mainkey;
                  console.log(key1 +'-'+ key2);
                  console.log(predicates[key1][key2]);
                  
                  var data = {
                      'action': "getQuery",
                      'query': predicates[key1][key2],
                      'editor': editor
                  };
            
            console.log(data)
            
            
            
            $.ajax({
            url: "https://cors-anywhere.herokuapp.com/http://wave.ttu.edu/ajax.php",
            type: "POST",
            headers: {
              "X-Requested-With": "XMLHttpRequest"
            },
            data: {
              action: "getQuery",
              query: predicates[key1][key2],
              editor: editor
            },
            success: function(response) {
              console.log(response);
               const answer = response || 'Sorry, I could not find an answer.';
               answerDiv.innerHTML = answer;
               answerBox.innerHTML = answer;
               var elem = answerBox.getElementsByTagName('p');
               var TextInsideLi = elem[0].innerHTML;
               console.log(TextInsideLi)
               
            },
            error: function(xhr, status, error) {
              console.log("error: " + error);
            }
          });
  
  
  
              }
          }
          
   
  
      </script>
  
  </body>
  
</html>